{# templates/article/liste.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Articles disponibles{% endblock %}
{% block page_title %}üì∞ Articles publi√©s{% endblock %}

{% block content %}
    <form method="get"
          action="{{ path('article_liste') }}"
          class="row g-3 mb-4"
          role="search"
          aria-label="Filtrer les articles">

        <div class="col-12 col-md-5">
            <label for="q" class="visually-hidden">Rechercher un article</label>
            <input id="q"
                   type="text"
                   name="q"
                   class="form-control"
                   placeholder="Rechercher un article‚Ä¶"
                   value="{{ search }}"
                   autocomplete="off">
        </div>

        <div class="col-12 col-md-5">
            <label for="categorie" class="visually-hidden">Cat√©gorie</label>
            <select id="categorie" name="categorie" class="form-select">
                <option value="">Toutes les cat√©gories</option>
                {% for cat in categoriesDisponibles %}
                    <option value="{{ cat }}" {{ cat == categorie ? 'selected' : '' }}>{{ cat }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-12 col-md-2 d-grid">
            <button class="btn btn-outline-primary">Filtrer</button>
        </div>
    </form>

    {% if articles|length > 0 %}
        <div class="row g-4">
            {% for article in articles %}
                <div class="col-12 col-md-6 col-lg-4">
                    <article class="card h-100 shadow-sm border-0">
                        {% set imgSrc = article.image
                            ? asset('uploads/' ~ article.image)
                            : asset('images/placeholder-article.jpg') %}

                        <img src="{{ imgSrc }}"
                             alt="{{ article.titre }}"
                             class="card-img-top"
                             loading="lazy"
                             onerror="this.onerror=null;this.src='{{ asset('images/placeholder-article.jpg') }}'">

                        <div class="card-body d-flex flex-column">
                            <h2 class="h5 card-title">{{ article.titre }}</h2>

                            <p class="card-text small text-muted mb-1">
                                üóÇÔ∏è Cat√©gorie : {{ article.categorie ?? 'Non pr√©cis√©e' }}
                            </p>

                            <p class="card-text">
                                {{ article.contenu|striptags|u.truncate(120, '‚Ä¶', false) }}
                            </p>

                            <a href="{{ path('article_show', {
                                id: article.id,
                                from: 'liste',
                                q: search,
                                categorie: categorie,
                                page: app.request.query.get('page')|default(1)
                            }) }}"
                               class="btn btn-sm btn-primary mt-auto"
                               aria-label="Lire l‚Äôarticle : {{ article.titre }}">
                                Lire l‚Äôarticle
                            </a>
                        </div>

                        <div class="card-footer text-muted small">
                            üïí Publi√© le {{ article.date ? article.date|date('d/m/Y') : '‚Äî' }}
                        </div>
                    </article>
                </div>
            {% endfor %}
        </div>

        <div class="pagination justify-content-center mt-4">
            {# Conserve les filtres dans la pagination #}
            {{ knp_pagination_render(articles, null, { query: app.request.query.all }) }}
        </div>
    {% else %}
        <div class="alert alert-info" role="status">
            Aucun article ne correspond √† votre recherche.
        </div>
    {% endif %}
{% endblock %}
