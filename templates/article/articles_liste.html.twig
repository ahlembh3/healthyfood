{# templates/article/liste.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Articles disponibles{% endblock %}

{# --- Banni√®re compacte : titre √† gauche + recherche/filtre dessus --- #}
{% block hero %}
    <section class="page-hero page-hero--sm"
             style="--hero-bg:url('{{ asset('images/banniere.png') }}')">
        <div class="page-hero__bg" aria-hidden="true"></div>
        <div class="page-hero__shade" aria-hidden="true"></div>

        <div class="page-hero__inner container-content" style="padding-top:16px; padding-bottom:24px;">
            <h1 class="page-hero__title">üì∞ <span class="text-vert">Articles</span></h1>
            <p class="text-muted mb-2">Parcourez nos articles et filtrez par mot-cl√© et cat√©gorie.</p>

            <form method="get"
                  action="{{ path('article_liste') }}"
                  class="hero-surface mt-2"
                  role="search"
                  aria-label="Filtrer les articles">
                <div class="row g-2">
                    <div class="col-12 col-md-6">
                        <label for="q" class="form-label">Rechercher un article</label>
                        <input id="q"
                               type="text"
                               name="q"
                               class="form-control"
                               placeholder="Titre, contenu‚Ä¶"
                               value="{{ search }}"
                               autocomplete="off">
                    </div>

                    <div class="col-12 col-md-4">
                        <label for="categorie" class="form-label">Cat√©gorie</label>
                        <select id="categorie" name="categorie" class="form-select">
                            <option value="">Toutes les cat√©gories</option>
                            {% for cat in categoriesDisponibles %}
                                <option value="{{ cat }}" {{ cat == categorie ? 'selected' : '' }}>{{ cat }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="col-12 col-md-2 d-grid align-content-end">
                        <button class="btn btn-primary" type="submit">Filtrer</button>
                    </div>
                </div>
            </form>
        </div>
    </section>
{% endblock %}

{# --- Contenu : grille des articles + pagination --- #}
{% block content %}
    {% if articles|length > 0 %}
        <section class="container-content py-4" aria-labelledby="liste-articles">
            <h2 id="liste-articles" class="visually-hidden">Liste des articles</h2>

            <div class="row g-4">
                {% for article in articles %}
                    <div class="col-12 col-md-6 col-lg-4">
                        <article class="card h-100 shadow-sm border-0">
                            {# Image en ratio pour un rendu homog√®ne #}
                            {% set imgSrc = article.image
                                ? asset('uploads/' ~ article.image)
                                : asset('images/placeholders/placeholder-article.jpg') %}

                            <div class="ratio ratio-16x9 bg-light">
                                <img src="{{ imgSrc }}"
                                     alt="{{ article.titre }}"
                                     class="w-100 h-100"
                                     style="object-fit:cover; object-position:center;"
                                     loading="lazy"
                                     onerror="this.onerror=null;this.src='{{ asset('images/placeholder-article.jpg') }}'">
                            </div>

                            <div class="card-body d-flex flex-column">
                                <h2 class="h5 card-title mb-2">{{ article.titre }}</h2>

                                <p class="card-text small text-muted mb-1">
                                    üóÇÔ∏è Cat√©gorie : {{ article.categorie ?? 'Non pr√©cis√©e' }}
                                </p>

                                <p class="card-text">
                                    {{ article.contenu|striptags|u.truncate(120, '‚Ä¶', false) }}
                                </p>

                                <a href="{{ path('article_show', {
                                    id: article.id,
                                    from: 'liste',
                                    q: search,
                                    categorie: categorie,
                                    page: app.request.query.get('page')|default(1)
                                }) }}"
                                   class="btn btn-sm btn-primary mt-auto"
                                   aria-label="Lire l‚Äôarticle : {{ article.titre }}">
                                    Lire l‚Äôarticle
                                </a>
                            </div>

                            <div class="card-footer text-muted small">
                                üïí Publi√© le {{ article.date ? article.date|date('d/m/Y') : '‚Äî' }}
                            </div>
                        </article>
                    </div>
                {% endfor %}
            </div>

            <div class="pagination justify-content-center mt-4">
                {{ knp_pagination_render(articles, null, { query: app.request.query.all }) }}
            </div>
        </section>
    {% else %}
        <section class="container-content py-4">
            <div class="alert alert-info" role="status">
                Aucun article ne correspond √† votre recherche.
            </div>
        </section>
    {% endif %}
{% endblock %}
