{# templates/utilisateur/_form.html.twig #}
{% set is_edit = form.vars.data is defined and form.vars.data.id %}

<div class="d-flex justify-content-center mt-5">
    <div class="card shadow p-4" style="max-width: 500px; width: 100%;">
        <h1 class="text-center mb-4" id="form-title">{{ form_title|default('Créer un compte') }}</h1>

        {{ form_start(form, {'attr': {'aria-labelledby': 'form-title', 'novalidate': 'novalidate'}}) }}

        {# Prénom #}
        <div class="mb-3">
            {{ form_label(form.prenom, null, {'label_attr': {'class': 'form-label', 'for': form.prenom.vars.id}}) }}
            <div class="input-group">
                <span class="input-group-text" id="prenom-icon" aria-hidden="true"><i class="bi bi-person"></i></span>
                {{ form_widget(form.prenom, {
                    attr: {
                        class: 'form-control',
                        autocomplete: 'given-name',
                        'aria-required': 'true',
                        'aria-describedby': 'prenom-icon ' ~ form.prenom.vars.id ~ '_error',
                        'aria-invalid': not form.prenom.vars.valid ? 'true' : 'false'
                    }
                }) }}
            </div>
            <div id="{{ form.prenom.vars.id }}_error" class="text-danger" role="alert">
                {{ form_errors(form.prenom) }}
            </div>
        </div>

        {# Nom #}
        <div class="mb-3">
            {{ form_label(form.nom, null, {'label_attr': {'class': 'form-label', 'for': form.nom.vars.id}}) }}
            <div class="input-group">
                <span class="input-group-text" id="nom-icon" aria-hidden="true"><i class="bi bi-person-fill"></i></span>
                {{ form_widget(form.nom, {
                    attr: {
                        class: 'form-control',
                        autocomplete: 'family-name',
                        'aria-required': 'true',
                        'aria-describedby': 'nom-icon ' ~ form.nom.vars.id ~ '_error',
                        'aria-invalid': not form.nom.vars.valid ? 'true' : 'false'
                    }
                }) }}
            </div>
            <div id="{{ form.nom.vars.id }}_error" class="text-danger" role="alert">
                {{ form_errors(form.nom) }}
            </div>
        </div>

        {# Email #}
        <div class="mb-3">
            {{ form_label(form.email, null, {'label_attr': {'class': 'form-label', 'for': form.email.vars.id}}) }}
            <div class="input-group">
                <span class="input-group-text" id="email-icon" aria-hidden="true"><i class="bi bi-envelope"></i></span>
                {{ form_widget(form.email, {
                    attr: {
                        class: 'form-control',
                        autocomplete: 'email',
                        'aria-required': 'true',
                        'aria-describedby': 'email-icon ' ~ form.email.vars.id ~ '_error',
                        'aria-invalid': not form.email.vars.valid ? 'true' : 'false'
                    }
                }) }}
            </div>
            <div id="{{ form.email.vars.id }}_error" class="text-danger" role="alert">
                {{ form_errors(form.email) }}
            </div>
        </div>

        {# MDP + confirmation uniquement en création #}
        {% if not is_edit %}
        <div class="mb-3">
            {{ form_label(form.password, null, {'label_attr': {'class': 'form-label', 'for': form.password.vars.id}}) }}
            <div class="input-group">
                <span class="input-group-text" id="password-icon" aria-hidden="true"><i class="bi bi-lock"></i></span>
                {{ form_widget(form.password, {
                    attr: {
                        class: 'form-control',
                        autocomplete: 'new-password',
                        'aria-required': 'true',
                        'aria-describedby': 'password-icon ' ~ form.password.vars.id ~ '_error',
                        'aria-invalid': not form.password.vars.valid ? 'true' : 'false'
                    }
                }) }}
            </div>
            <div id="{{ form.password.vars.id }}_error" class="text-danger" role="alert">
                {{ form_errors(form.password) }}
            </div>
        </div>

        {% if form.confirmPassword is defined %}
        <div class="mb-3">
            {{ form_label(form.confirmPassword, null, {'label_attr': {'class': 'form-label', 'for': form.confirmPassword.vars.id}}) }}
            <div class="input-group">
                <span class="input-group-text" id="confirm-icon" aria-hidden="true"><i class="bi bi-lock-fill"></i></span>
                {{ form_widget(form.confirmPassword, {
                    attr: {
                        class: 'form-control',
                        autocomplete: 'new-password',
                        'aria-required': 'true',
                        'aria-describedby': 'confirm-icon ' ~ form.confirmPassword.vars.id ~ '_error',
                        'aria-invalid': not form.confirmPassword.vars.valid ? 'true' : 'false'
                    }
                }) }}
            </div>
            <div id="{{ form.confirmPassword.vars.id }}_error" class="text-danger" role="alert">
                {{ form_errors(form.confirmPassword) }}
            </div>
        </div>
        {% endif %}
        {% endif %}

        {# Préférences (facultatif) #}
        <div class="mb-3">
            {{ form_label(form.preferences, null, {'label_attr': {'class': 'form-label', 'for': form.preferences.vars.id}}) }}
            {{ form_widget(form.preferences, {
                attr: {
                    class: 'form-control',
                    rows: '3',
                    placeholder: 'Décrivez vos préférences...',
                    'aria-describedby': form.preferences.vars.id ~ '_error',
                    'aria-invalid': not form.preferences.vars.valid ? 'true' : 'false'
                }
            }) }}
            <div id="{{ form.preferences.vars.id }}_error" class="text-danger" role="alert">
                {{ form_errors(form.preferences) }}
            </div>
        </div>

        <button type="submit" class="btn btn-primary w-100" aria-label="{{ button_label|default(\"S'inscrire\") }}">
        {{ button_label|default(\"S'inscrire\") }}
        </button>

        {{ form_end(form) }}
    </div>
</div>
