{# templates/commentaire/signes.html.twig (exemple) #}
{% extends 'base.html.twig' %}

{% block title %}Commentaires signalés{% endblock %}
{% block page_title %}Commentaires signalés{% endblock %}

{% block content %}
    {% if commentaires is empty %}
        <div class="alert alert-info">Aucun commentaire signalé.</div>
    {% else %}
        <div class="list-group list-group-flush">
            {% for commentaire in commentaires %}
                <article class="list-group-item mb-3 border rounded p-3 shadow-sm border-danger bg-light">
                    <header class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                        <div>
                            <h2 class="h6 mb-1">
                                {{ commentaire.utilisateur ? commentaire.utilisateur.email : 'Compte supprimé' }}
                            </h2>
                            <small class="text-muted">
                                {{ commentaire.date ? commentaire.date|date('d/m/Y H:i') : 'Date inconnue' }}
                            </small>
                        </div>
                        <span class="badge bg-danger">Signalé</span>
                    </header>

                    <p class="mt-2 mb-1">{{ commentaire.contenu }}</p>
                    <p class="mb-2"><strong>Note :</strong> {{ commentaire.note is not null ? commentaire.note : 'Non notée' }}</p>

                    <p class="mb-1">
                        <strong>Signalé par :</strong>
                        {% if commentaire.signalePar %}
                            {{ commentaire.signalePar.email }}
                        {% else %}
                            <em>Utilisateur inconnu</em>
                        {% endif %}
                    </p>
                    <p class="mb-2"><strong>Le :</strong> {{ commentaire.signaleLe ? commentaire.signaleLe|date('d/m/Y H:i') : 'Date inconnue' }}</p>

                    <p class="mb-2">
                        <strong>Contenu lié :</strong>
                        {% if commentaire.recette %}
                            Recette :
                            <a href="{{ path('recette_show', { id: commentaire.recette.id }) }}">
                                {{ commentaire.recette.titre }}
                            </a>
                        {% elseif commentaire.article %}
                            Article :
                            <a href="{{ path('article_show', { id: commentaire.article.id }) }}">
                                {{ commentaire.article.titre }}
                            </a>
                        {% else %}
                            Aucun contenu associé
                        {% endif %}
                    </p>

                    <div class="d-flex gap-2 mt-2 flex-wrap">
                        <a href="{{ path('commentaire_show', { id: commentaire.id }) }}"
                           class="btn btn-sm btn-outline-primary">
                            Voir
                        </a>

                        <form method="post"
                              action="{{ path('commentaire_delete', { id: commentaire.id }) }}"
                              class="d-inline"
                              onsubmit="if(confirm('Confirmer la suppression ?')){ this.querySelector('button[type=submit]').disabled = true; return true;} return false;">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ commentaire.id) }}">
                            <button class="btn btn-sm btn-danger" aria-label="Supprimer le commentaire">
                                Supprimer
                            </button>
                        </form>

                        <form method="post"
                              action="{{ path('commentaire_designaler', { id: commentaire.id }) }}"
                              class="d-inline"
                              onsubmit="if(confirm('Voulez-vous désignaliser ce commentaire ?')){ this.querySelector('button[type=submit]').disabled = true; return true;} return false;">
                            <input type="hidden" name="_token" value="{{ csrf_token('designaler' ~ commentaire.id) }}">
                            <button class="btn btn-sm btn-warning" aria-label="Désignaler le commentaire">
                                Désignaler
                            </button>
                        </form>
                    </div>
                </article>
            {% endfor %}
        </div>
    {% endif %}

    <a href="{{ path('commentaire_index') }}" class="btn btn-secondary mt-4">Retour à la liste complète</a>
{% endblock %}
