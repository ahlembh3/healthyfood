{# templates/plante/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Liste des plantes{% endblock %}

{# --- Banni√®re compacte : titre align√© √† gauche + recherche dessus --- #}
{% block hero %}
    <section class="page-hero page-hero--sm"
             style="--hero-bg:url('{{ asset('images/banniere.png') }}')">
        <div class="page-hero__bg" aria-hidden="true"></div>
        <div class="page-hero__shade" aria-hidden="true"></div>

        {# padding r√©duit pour coller au header #}
        <div class="page-hero__inner container-content" style="padding-top:16px; padding-bottom:24px;">
            <h1 class="page-hero__title">üåø <span class="text-vert">Plantes m√©dicinales</span></h1>
            <p class="text-muted mb-2">Recherchez une plante par nom ou parcourez la liste.</p>

            <form method="get"
                  action="{{ path('plante_index') }}"
                  class="hero-surface mt-2"
                  role="search"
                  aria-label="Rechercher une plante">
                <div class="row g-2 align-items-end">
                    <div class="col-12 col-md-8">
                        <label for="q" class="form-label">Rechercher une plante</label>
                        <input
                                type="text"
                                id="q"
                                name="q"
                                class="form-control"
                                placeholder="ex. Camomille, menthe‚Ä¶"
                                value="{{ app.request.query.get('q') }}"
                                autocomplete="off">
                    </div>
                    <div class="col-12 col-md-4 d-grid">
                        <button class="btn btn-primary" type="submit">Rechercher</button>
                    </div>
                </div>
            </form>
        </div>
    </section>
{% endblock %}

{# --- Liste + pagination --- #}
{% block content %}
    {% if pagination.items is empty %}
        <section class="container-content py-4">
            <div class="alert alert-info mb-0">Aucune plante trouv√©e.</div>
        </section>
    {% else %}
        <section class="container-content py-4" aria-labelledby="liste-plantes">
            <h2 id="liste-plantes" class="visually-hidden">Liste des plantes</h2>

            <div class="row g-4">
                {% for plante in pagination %}
                    <div class="col-sm-6 col-md-4">
                        <article class="card h-100 shadow-sm border-0">
                            <div class="ratio ratio-4x3 bg-light">
                                {% set img = plante.image|default('')|trim %}
                                {% set src = img ? asset('uploads/plantes/' ~ img) : asset('images/placeholders/placeholder-plante.jpg') %}
                                <img
                                        src="{{ src }}"
                                        alt="{{ img ? 'Photo de ' ~ plante.nomCommun : 'Image g√©n√©rique de plante' }}"
                                        class="w-100 h-100"
                                        style="object-fit:cover; object-position:center;"
                                        loading="lazy"
                                        onerror="this.onerror=null;this.src='{{ asset('images/placeholders/placeholder-plante.jpg') }}';">
                            </div>

                            <div class="card-body d-flex flex-column">
                                <h3 class="h5 card-title mb-2">{{ plante.nomCommun }}</h3>
                                {% if plante.nomScientifique %}
                                    <p class="text-muted fst-italic mb-2">{{ plante.nomScientifique }}</p>
                                {% endif %}
                                <p class="card-text text-muted mb-3">
                                    {{ plante.description|striptags|u.truncate(120, '‚Ä¶') }}
                                </p>
                                <a
                                        href="{{ path('plante_show', { id: plante.id }) }}"
                                        class="btn btn-outline-primary mt-auto"
                                        aria-label="En savoir plus sur {{ plante.nomCommun }}">
                                    En savoir plus
                                </a>
                            </div>
                        </article>
                    </div>
                {% endfor %}
            </div>

            <div class="mt-4 d-flex justify-content-center">
                {{ knp_pagination_render(pagination, null, { query: app.request.query.all }) }}
            </div>
        </section>
    {% endif %}
{% endblock %}
