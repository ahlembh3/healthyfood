{# templates/plante/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Liste des plantes{% endblock %}
{% block page_title %}ðŸŒ¿ Nos plantes mÃ©dicinales{% endblock %}

{% block content %}
    <section aria-labelledby="recherche-plantes" class="mb-4">
        <h2 id="recherche-plantes" class="visually-hidden">Recherche de plantes</h2>
        <form method="get" action="{{ path('plante_index') }}" role="search" aria-label="Rechercher une plante">
            <div class="input-group">
                <label for="q" class="visually-hidden">Rechercher une plante</label>
                <input
                        type="text"
                        id="q"
                        name="q"
                        class="form-control"
                        placeholder="Rechercher une planteâ€¦"
                        value="{{ app.request.query.get('q') }}"
                        autocomplete="off"
                >
                <button class="btn btn-primary" type="submit">Rechercher</button>
            </div>
        </form>
    </section>

    {% if pagination.items is empty %}
        <div class="alert alert-info mb-0">Aucune plante trouvÃ©e.</div>
    {% else %}
        <section aria-labelledby="liste-plantes">
            <h2 id="liste-plantes" class="visually-hidden">Liste des plantes</h2>
            <div class="row g-4">
                {% for plante in pagination %}
                    <div class="col-sm-6 col-md-4">
                        <article class="card h-100 shadow-sm border-0">
                            <div class="ratio ratio-4x3 bg-light">
                                {% set img = plante.image|default('')|trim %}
                                {% set src = img ? asset('uploads/plantes/' ~ img) : asset('images/placeholder-plant.jpg') %}
                                <img
                                        src="{{ src }}"
                                        alt="{{ img ? 'Photo de ' ~ plante.nomCommun : 'Image gÃ©nÃ©rique de plante' }}"
                                        class="rounded-top w-100 h-100"
                                        style="object-fit: cover;"
                                        loading="lazy"
                                >
                            </div>

                            <div class="card-body">
                                <h3 class="h5 card-title mb-2">{{ plante.nomCommun }}</h3>
                                <p class="card-text text-muted mb-3">
                                    {{ plante.description|striptags|u.truncate(120, 'â€¦') }}
                                </p>
                                <a
                                        href="{{ path('plante_show', { id: plante.id }) }}"
                                        class="btn btn-outline-primary"
                                        aria-label="En savoir plus sur {{ plante.nomCommun }}"
                                >
                                    En savoir plus
                                </a>
                            </div>
                        </article>
                    </div>
                {% endfor %}
            </div>

            <div class="mt-4 d-flex justify-content-center">
                {{ knp_pagination_render(pagination) }}
                {# si besoin de conserver explicitement la query:
           {{ knp_pagination_render(pagination, null, { query: app.request.query.all }) }} #}
            </div>
        </section>
    {% endif %}
{% endblock %}
