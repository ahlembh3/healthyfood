{# templates/admin_dashboard/tisane/index.html.twig #}
{% extends 'base.html.twig' %}
{% import 'admin_dashboard/_actions.html.twig' as A %}

{% block title %}Gestion des Tisanes - Admin{% endblock %}
{% block page_title %}Gestion des Tisanes{% endblock %}

{% block content %}
    <section class="mb-4">
        <div class="d-flex flex-column flex-sm-row align-items-sm-center gap-3">
            <div class="d-flex align-items-center gap-3">
                <i class="bi bi-cup-hot fs-3 text-success" aria-hidden="true"></i>
                <div>
                    <h2 class="h5 mb-1">Liste des tisanes</h2>
                    <p class="text-muted mb-0">
                        {{ tisanes|length }} {{ tisanes|length == 1 ? 'résultat' : 'résultats' }} — plantes & bienfaits mis en avant.
                    </p>
                </div>
            </div>
            <div class="ms-sm-auto">
                <a href="{{ path('admin_tisane_new') }}" class="btn btn-success">
                    <i class="bi bi-plus-lg me-1" aria-hidden="true"></i> Nouvelle tisane
                </a>
            </div>
        </div>
    </section>

    <div class="card border-0 shadow-sm">
        <div class="card-body">
            {% if tisanes is empty %}
                <div class="text-center py-5">
                    <i class="bi bi-emoji-smile fs-1 text-success d-block mb-2" aria-hidden="true"></i>
                    <p class="text-muted mb-3">Aucune tisane pour le moment.</p>
                    <a href="{{ path('admin_tisane_new') }}" class="btn btn-success">
                        <i class="bi bi-plus-lg me-1" aria-hidden="true"></i> Créer la première tisane
                    </a>
                </div>
            {% else %}
                <div class="table-responsive">
                    <table class="table align-middle table-hover">
                        <caption class="visually-hidden">
                            Tableau des tisanes avec identifiant, nom, plantes, bienfaits et actions.
                        </caption>
                        <thead class="table-light">
                        <tr>
                            <th scope="col" style="width:80px;">#</th>
                            <th scope="col">Tisane</th>

                            {# Colonnes “lourdes” masquées en < lg pour laisser respirer l’UI #}
                            <th scope="col" class="d-none d-lg-table-cell">Plantes</th>
                            <th scope="col" class="d-none d-lg-table-cell">Bienfaits</th>

                            {# Colonne Actions : largeur contrainte au contenu (évite la demi-coupure) #}
                            <th scope="col" class="text-end" style="width:1%; white-space:nowrap;">Actions</th>
                        </tr>
                        </thead>

                        <tbody>
                        {% for tisane in tisanes %}
                            <tr>
                                <td class="text-muted">{{ tisane.id }}</td>

                                <td class="text-break">
                                    <div class="fw-semibold">{{ tisane.nom }}</div>
                                    <div class="text-muted small">
                                        {% if tisane.image %}
                                            <i class="bi bi-image me-1" aria-hidden="true"></i>Avec image
                                        {% else %}
                                            <i class="bi bi-image-alt me-1" aria-hidden="true"></i>Sans image
                                        {% endif %}
                                    </div>
                                </td>

                                <td class="d-none d-lg-table-cell">
                                    <div class="d-flex flex-wrap gap-1">
                                        {% for plante in tisane.plantes|slice(0,3) %}
                                            <span class="badge rounded-pill text-bg-success">{{ plante.nomCommun }}</span>
                                        {% endfor %}
                                        {% if tisane.plantes|length > 3 %}
                                            <span class="badge rounded-pill text-bg-secondary">+{{ tisane.plantes|length - 3 }}</span>
                                        {% endif %}
                                    </div>
                                </td>

                                <td class="d-none d-lg-table-cell">
                                    <div class="d-flex flex-wrap gap-1">
                                        {% for bienfait in tisane.bienfaits|slice(0,3) %}
                                            <span class="badge rounded-pill text-bg-success">{{ bienfait.nom }}</span>
                                        {% endfor %}
                                        {% if tisane.bienfaits|length > 3 %}
                                            <span class="badge rounded-pill text-bg-secondary">+{{ tisane.bienfaits|length - 3 }}</span>
                                        {% endif %}
                                    </div>
                                </td>

                                <td class="text-end">
                                    {{ A.row(
                                        { href: path('admin_tisane_show', { id: tisane.id }), label: 'Voir' },
                                        { href: path('admin_tisane_edit', { id: tisane.id }), label: 'Modifier' },
                                        {
                                            href:   path('admin_tisane_delete', { id: tisane.id }),
                                            label:  'Supprimer',
                                            token:  csrf_token('delete' ~ tisane.id),
                                            confirm:'Supprimer « ' ~ (tisane.nom ?: 'cette tisane') ~ ' » ?',
                                            disabled:false
                                        }
                                    ) }}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
        </div>
    </div>

    {% if tisanes is defined and tisanes is iterable and tisanes|length > 0 and tisanes.paginationData is defined %}
        <div class="mt-3 d-flex justify-content-center">
            {{ knp_pagination_render(tisanes) }}
        </div>
    {% endif %}
{% endblock %}
