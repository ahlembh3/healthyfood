<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{% block title %}Accueil{% endblock %} - SantÃ© & Nature</title>

    {% block stylesheets %}
        {# Fonts #}
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">

        {# Bootstrap + Bootstrap Icons #}
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

        {# ThÃ¨me #}
        <link rel="stylesheet" href="{{ asset('styles/theme.css') }}">
    {% endblock %}
</head>
<body>

<a href="#main" class="skip-link">Aller au contenu</a>

{# FAB accessibilitÃ© â€” icÃ´ne bonhomme #}
<div class="a11y-fab" data-a11y>
    <button id="a11yFab" class="a11y-fab-btn" type="button" aria-expanded="false" aria-controls="a11yPanel" aria-label="Options d'accessibilitÃ©">
        <span aria-hidden="true">ðŸ‘¤</span>
    </button>
    <div id="a11yPanel" class="a11y-panel shadow" hidden>
        <div class="btn-group w-100 mb-2" role="group" aria-label="Taille du texte">
            <button id="fontUp" class="btn btn-outline-secondary btn-sm" type="button">A+</button>
            <button id="fontReset" class="btn btn-outline-secondary btn-sm" type="button">A</button>
        </div>
        <button id="toggleDark" class="btn btn-outline-secondary btn-sm w-100 mb-2" type="button">ðŸŒ“ Mode sombre</button>
        <button id="readBtn" class="btn btn-outline-secondary btn-sm w-100" type="button" aria-pressed="false">ðŸ”Š Lecture</button>
    </div>
</div>

{% include 'partials/_header.html.twig' %}

{% block hero %}{% endblock %}

<div class="container mt-3">
    {% for type, messages in app.flashes %}
        {% set bs = type == 'error' ? 'danger' : (type == 'notice' ? 'info' : type) %}
        {% for message in messages %}
            <div class="alert alert-{{ bs }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fermer"></button>
            </div>
        {% endfor %}
    {% endfor %}
</div>

{% block body %}
    <main id="main" tabindex="-1">
        {% block content %}{% endblock %}
    </main>
{% endblock %}

{% include 'partials/_footer.html.twig' %}

{% block javascripts %}
    {{ importmap('app', { 'data-turbo-track': 'reload' }) }}

    <script src="https://cdn.jsdelivr.net/npm/tinymce@6.8.3/tinymce.min.js" referrerpolicy="origin"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tinymce/tinymce-i18n@latest/langs/fr_FR.js" referrerpolicy="origin"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <script>
        // TinyMCE
        function mountTinyMCE() {
            const areas = document.querySelectorAll('textarea.tinymce-editor');
            if (!areas.length) return;
            areas.forEach((el) => {
                if (el.dataset.editorInited === '1') return;
                tinymce.init({
                    target: el, language: 'fr_FR', menubar: false, branding: false, height: 320,
                    plugins: 'lists link table code',
                    toolbar: 'undo redo | styles | bold italic underline | bullist numlist | link table | removeformat | code',
                    convert_urls: false,
                    content_style: 'body { font-family: "Open Sans", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; font-size: 16px; }',
                    setup: (editor) => { editor.on('init', () => { el.dataset.editorInited = '1'; }); }
                });
            });
        }
        document.addEventListener('submit', function() {
            if (document.querySelector('textarea.tinymce-editor')) tinymce.triggerSave();
        }, true);
        document.addEventListener('DOMContentLoaded', mountTinyMCE);
        document.addEventListener('turbo:load', mountTinyMCE);

        // Fallback images
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('img[data-fallback-src]').forEach(img => {
                img.addEventListener('error', () => {
                    const fallback = img.getAttribute('data-fallback-src');
                    if (fallback && img.src !== fallback) { img.src = fallback; }
                }, { once: true });
            });
        });

        // Tooltips Bootstrap (optionnel)
        document.addEventListener('DOMContentLoaded', () => {
            if (window.bootstrap) {
                document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => new bootstrap.Tooltip(el));
            }
        });
    </script>
{% endblock %}

</body>
</html>
